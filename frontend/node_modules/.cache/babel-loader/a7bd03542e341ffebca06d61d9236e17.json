{"ast":null,"code":"import { Vector3, Matrix3 } from \"three\";\nexport class Box {\n  // inertia tensor in body space\n  // the orientation\n  constructor(position, width, length, height) {\n    this.inverseMass = void 0;\n    this.width = void 0;\n    this.length = void 0;\n    this.height = void 0;\n    this.inertia = void 0;\n    this.position = void 0;\n    this.momentum = void 0;\n    this.rotation = void 0;\n    this.angularMomentum = void 0;\n    this.inverseMass = 1 / (width * length * height);\n    this.width = width;\n    this.length = length;\n    this.height = height;\n    this.inertia = new Matrix3();\n    this.setInertia();\n    this.position = position;\n    this.momentum = new Vector3(1, 0, 0).multiplyScalar(1 / this.inverseMass);\n    this.rotation = new Matrix3();\n    this.rotation.set(Math.cos(Math.PI / 2), -Math.sin(Math.PI / 2), 0, Math.sin(Math.PI / 2), Math.cos(Math.PI / 2), 0, 0, 0, 1);\n    console.log(\"rotation: \", this.rotation.elements);\n    this.angularMomentum = new Vector3(0, 0, 1).applyMatrix3(this.inertia);\n  }\n\n  setInertia() {\n    const I_xx = 1 / 12 * (this.length * this.length + this.height * this.height);\n    const I_yy = 1 / 12 * (this.width * this.width + this.height * this.height);\n    const I_zz = 1 / 12 * (this.width * this.width + this.length * this.length);\n    const I_xy = -1 / 16 * (this.width * this.length);\n    const I_yx = I_xy;\n    const I_xz = -1 / 16 * (this.width * this.height);\n    const I_zx = I_xz;\n    const I_yz = -1 / 16 * (this.length * this.height);\n    const I_zy = I_yz;\n    this.inertia.set(I_xx, I_xy, I_xz, I_yx, I_yy, I_yz, I_zx, I_zy, I_zz);\n  }\n\n  integrate(duration) {\n    // Don't integrate if mass is infinite or duration <= 0.\n    if (this.inverseMass <= 0 || duration <= 0) {\n      return;\n    }\n\n    this.position.addScaledVector(this.momentum, this.inverseMass * duration); // update rotation matrix\n\n    const I_b_inverse = this.inertia.clone().invert();\n    const I_inverse = I_b_inverse.clone().premultiply(this.rotation).multiply(this.rotation.clone().transpose());\n    const angularVelocity = this.angularMomentum.clone().applyMatrix3(I_inverse);\n    const dRotation = angularVelocity.multiplyScalar(duration);\n    const dRotation_star = new Matrix3();\n    dRotation_star.set(0, -dRotation.z, dRotation.y, dRotation.z, 0, dRotation.x, -dRotation.y, dRotation.x, 0); // this.rotation.premultiply(dRotation_star);\n  }\n\n  testIntegrate(duration) {// update rotation matrix\n  }\n\n}","map":{"version":3,"names":["Vector3","Matrix3","Box","constructor","position","width","length","height","inverseMass","inertia","momentum","rotation","angularMomentum","setInertia","multiplyScalar","set","Math","cos","PI","sin","console","log","elements","applyMatrix3","I_xx","I_yy","I_zz","I_xy","I_yx","I_xz","I_zx","I_yz","I_zy","integrate","duration","addScaledVector","I_b_inverse","clone","invert","I_inverse","premultiply","multiply","transpose","angularVelocity","dRotation","dRotation_star","z","y","x","testIntegrate"],"sources":["/Users/danny/Github/physics_engine_for_the_web/frontend/src/physics_engine/Box.ts"],"sourcesContent":["import * as THREE from \"three\";\nimport { Vector3, Matrix3 } from \"three\";\n\nexport class Box {\n    public inverseMass: number;\n\n    public width: number;\n    public length: number;\n    public height: number;\n\n    public inertia: Matrix3; // inertia tensor in body space\n\n    public position: Vector3;\n    public momentum: Vector3;\n\n    public rotation: Matrix3; // the orientation\n    public angularMomentum: Vector3;\n\n    constructor(position: Vector3, width: number, length: number, height: number) {\n        this.inverseMass = 1 / (width * length * height);\n\n        this.width = width;\n        this.length = length;\n        this.height = height;\n\n        this.inertia = new Matrix3();\n        this.setInertia();\n        \n        this.position = position;\n        this.momentum = (new Vector3(1, 0, 0)).multiplyScalar(1/this.inverseMass);\n\n        this.rotation = new Matrix3();\n        this.rotation.set(\n            Math.cos(Math.PI/2), -Math.sin(Math.PI/2), 0,\n            Math.sin(Math.PI/2), Math.cos(Math.PI/2), 0,\n            0, 0, 1\n        );\n        console.log(\"rotation: \", this.rotation.elements);\n        this.angularMomentum = new Vector3(0, 0, 1).applyMatrix3(this.inertia);\n    }\n\n    private setInertia(): void {\n        const I_xx = (1/12) * (this.length*this.length + this.height*this.height);\n        const I_yy = (1/12) * (this.width*this.width + this.height*this.height);\n        const I_zz = (1/12) * (this.width*this.width + this.length*this.length);\n        const I_xy = (-1/16) * (this.width*this.length);\n        const I_yx = I_xy;\n        const I_xz = (-1/16) * (this.width*this.height);\n        const I_zx = I_xz;\n        const I_yz = (-1/16) * (this.length*this.height);\n        const I_zy = I_yz;\n\n        this.inertia.set(\n            I_xx, I_xy, I_xz,\n            I_yx, I_yy, I_yz,\n            I_zx, I_zy, I_zz\n        );\n    }\n\n    integrate(duration: number): void {\n        // Don't integrate if mass is infinite or duration <= 0.\n        if (this.inverseMass <= 0 || duration <= 0) {\n            return;\n        }\n\n        this.position.addScaledVector(this.momentum, this.inverseMass * duration);\n\n        // update rotation matrix\n        const I_b_inverse = this.inertia.clone().invert();\n        const I_inverse = (I_b_inverse.clone().premultiply(this.rotation)).multiply(this.rotation.clone().transpose());\n        const angularVelocity = this.angularMomentum.clone().applyMatrix3(I_inverse);\n        const dRotation = angularVelocity.multiplyScalar(duration);\n        const dRotation_star = new Matrix3();\n        dRotation_star.set(\n            0, -dRotation.z, dRotation.y,\n            dRotation.z, 0, dRotation.x,\n            -dRotation.y, dRotation.x, 0\n        );\n        // this.rotation.premultiply(dRotation_star);\n    }\n\n    testIntegrate(duration: number): void {\n        // update rotation matrix\n    }\n}"],"mappings":"AACA,SAASA,OAAT,EAAkBC,OAAlB,QAAiC,OAAjC;AAEA,OAAO,MAAMC,GAAN,CAAU;EAOY;EAKC;EAG1BC,WAAW,CAACC,QAAD,EAAoBC,KAApB,EAAmCC,MAAnC,EAAmDC,MAAnD,EAAmE;IAAA,KAdvEC,WAcuE;IAAA,KAZvEH,KAYuE;IAAA,KAXvEC,MAWuE;IAAA,KAVvEC,MAUuE;IAAA,KARvEE,OAQuE;IAAA,KANvEL,QAMuE;IAAA,KALvEM,QAKuE;IAAA,KAHvEC,QAGuE;IAAA,KAFvEC,eAEuE;IAC1E,KAAKJ,WAAL,GAAmB,KAAKH,KAAK,GAAGC,MAAR,GAAiBC,MAAtB,CAAnB;IAEA,KAAKF,KAAL,GAAaA,KAAb;IACA,KAAKC,MAAL,GAAcA,MAAd;IACA,KAAKC,MAAL,GAAcA,MAAd;IAEA,KAAKE,OAAL,GAAe,IAAIR,OAAJ,EAAf;IACA,KAAKY,UAAL;IAEA,KAAKT,QAAL,GAAgBA,QAAhB;IACA,KAAKM,QAAL,GAAiB,IAAIV,OAAJ,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAAD,CAAuBc,cAAvB,CAAsC,IAAE,KAAKN,WAA7C,CAAhB;IAEA,KAAKG,QAAL,GAAgB,IAAIV,OAAJ,EAAhB;IACA,KAAKU,QAAL,CAAcI,GAAd,CACIC,IAAI,CAACC,GAAL,CAASD,IAAI,CAACE,EAAL,GAAQ,CAAjB,CADJ,EACyB,CAACF,IAAI,CAACG,GAAL,CAASH,IAAI,CAACE,EAAL,GAAQ,CAAjB,CAD1B,EAC+C,CAD/C,EAEIF,IAAI,CAACG,GAAL,CAASH,IAAI,CAACE,EAAL,GAAQ,CAAjB,CAFJ,EAEyBF,IAAI,CAACC,GAAL,CAASD,IAAI,CAACE,EAAL,GAAQ,CAAjB,CAFzB,EAE8C,CAF9C,EAGI,CAHJ,EAGO,CAHP,EAGU,CAHV;IAKAE,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0B,KAAKV,QAAL,CAAcW,QAAxC;IACA,KAAKV,eAAL,GAAuB,IAAIZ,OAAJ,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,EAAqBuB,YAArB,CAAkC,KAAKd,OAAvC,CAAvB;EACH;;EAEOI,UAAU,GAAS;IACvB,MAAMW,IAAI,GAAI,IAAE,EAAH,IAAU,KAAKlB,MAAL,GAAY,KAAKA,MAAjB,GAA0B,KAAKC,MAAL,GAAY,KAAKA,MAArD,CAAb;IACA,MAAMkB,IAAI,GAAI,IAAE,EAAH,IAAU,KAAKpB,KAAL,GAAW,KAAKA,KAAhB,GAAwB,KAAKE,MAAL,GAAY,KAAKA,MAAnD,CAAb;IACA,MAAMmB,IAAI,GAAI,IAAE,EAAH,IAAU,KAAKrB,KAAL,GAAW,KAAKA,KAAhB,GAAwB,KAAKC,MAAL,GAAY,KAAKA,MAAnD,CAAb;IACA,MAAMqB,IAAI,GAAI,CAAC,CAAD,GAAG,EAAJ,IAAW,KAAKtB,KAAL,GAAW,KAAKC,MAA3B,CAAb;IACA,MAAMsB,IAAI,GAAGD,IAAb;IACA,MAAME,IAAI,GAAI,CAAC,CAAD,GAAG,EAAJ,IAAW,KAAKxB,KAAL,GAAW,KAAKE,MAA3B,CAAb;IACA,MAAMuB,IAAI,GAAGD,IAAb;IACA,MAAME,IAAI,GAAI,CAAC,CAAD,GAAG,EAAJ,IAAW,KAAKzB,MAAL,GAAY,KAAKC,MAA5B,CAAb;IACA,MAAMyB,IAAI,GAAGD,IAAb;IAEA,KAAKtB,OAAL,CAAaM,GAAb,CACIS,IADJ,EACUG,IADV,EACgBE,IADhB,EAEID,IAFJ,EAEUH,IAFV,EAEgBM,IAFhB,EAGID,IAHJ,EAGUE,IAHV,EAGgBN,IAHhB;EAKH;;EAEDO,SAAS,CAACC,QAAD,EAAyB;IAC9B;IACA,IAAI,KAAK1B,WAAL,IAAoB,CAApB,IAAyB0B,QAAQ,IAAI,CAAzC,EAA4C;MACxC;IACH;;IAED,KAAK9B,QAAL,CAAc+B,eAAd,CAA8B,KAAKzB,QAAnC,EAA6C,KAAKF,WAAL,GAAmB0B,QAAhE,EAN8B,CAQ9B;;IACA,MAAME,WAAW,GAAG,KAAK3B,OAAL,CAAa4B,KAAb,GAAqBC,MAArB,EAApB;IACA,MAAMC,SAAS,GAAIH,WAAW,CAACC,KAAZ,GAAoBG,WAApB,CAAgC,KAAK7B,QAArC,CAAD,CAAiD8B,QAAjD,CAA0D,KAAK9B,QAAL,CAAc0B,KAAd,GAAsBK,SAAtB,EAA1D,CAAlB;IACA,MAAMC,eAAe,GAAG,KAAK/B,eAAL,CAAqByB,KAArB,GAA6Bd,YAA7B,CAA0CgB,SAA1C,CAAxB;IACA,MAAMK,SAAS,GAAGD,eAAe,CAAC7B,cAAhB,CAA+BoB,QAA/B,CAAlB;IACA,MAAMW,cAAc,GAAG,IAAI5C,OAAJ,EAAvB;IACA4C,cAAc,CAAC9B,GAAf,CACI,CADJ,EACO,CAAC6B,SAAS,CAACE,CADlB,EACqBF,SAAS,CAACG,CAD/B,EAEIH,SAAS,CAACE,CAFd,EAEiB,CAFjB,EAEoBF,SAAS,CAACI,CAF9B,EAGI,CAACJ,SAAS,CAACG,CAHf,EAGkBH,SAAS,CAACI,CAH5B,EAG+B,CAH/B,EAd8B,CAmB9B;EACH;;EAEDC,aAAa,CAACf,QAAD,EAAyB,CAClC;EACH;;AAhFY"},"metadata":{},"sourceType":"module"}