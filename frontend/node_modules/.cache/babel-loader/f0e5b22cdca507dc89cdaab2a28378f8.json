{"ast":null,"code":"import { Vector3, Matrix3 } from \"three\";\nexport class Box {\n  // inertia tensor in body space\n  // the orientation\n  constructor(position, width, length, height) {\n    this.inverseMass = void 0;\n    this.width = void 0;\n    this.length = void 0;\n    this.height = void 0;\n    this.inertia = void 0;\n    this.position = void 0;\n    this.momentum = void 0;\n    this.rotation = void 0;\n    this.angularMomentum = void 0;\n    this.inverseMass = 1 / (width * length * height);\n    this.width = width;\n    this.length = length;\n    this.height = height;\n    this.inertia = new Matrix3();\n    this.position = position;\n    this.momentum = new Vector3(1, 0, 0).multiplyScalar(1 / this.inverseMass);\n    this.rotation = new Matrix3();\n  }\n\n  setInertia() {\n    const I_xx = 1 / 12 * (this.length * this.length + this.height * this.height);\n    const I_yy = 1 / 12 * (this.width * this.width + this.height * this.height);\n    const I_zz = 1 / 12 * (this.width * this.width + this.length * this.length);\n    const I_xy = -1 / 16 * (this.width * this.length);\n    const I_yx = I_xy;\n    const I_xz = -1 / 16 * (this.width * this.height);\n    const I_zx = I_xz;\n    const I_yz = -1 / 16 * (this.length * this.height);\n    const I_zy = I_yz;\n    this.inertia.set(I_xx, I_xy, I_xz, I_yx, I_yy, I_yz, I_zx, I_zy, I_zz);\n  }\n\n  integrate(duration) {\n    // Don't integrate if mass is infinite or duration <= 0.\n    if (this.inverseMass <= 0 || duration <= 0) {\n      return;\n    }\n\n    this.position.addScaledVector(this.momentum, this.inverseMass * duration); // update rotation matrix\n\n    const I_b_inverse = this.inertia.clone().invert();\n    const I_inverse = I_b_inverse.clone().premultiply(this.rotation).multiply(this.rotation.clone().transpose());\n    const angularVelocity = this.angularMomentum.clone().applyMatrix3(I_inverse.clone());\n    const dRotation = angularVelocity.multiplyScalar(duration);\n    const dRotation_star = new Matrix3();\n    dRotation_star.set(0, -dRotation.z, dRotation.y, dRotation.z, 0, dRotation.x, -dRotation.y, dRotation.x, 0);\n    this.rotation.premultiply(dRotation_star);\n  }\n\n}","map":{"version":3,"names":["Vector3","Matrix3","Box","constructor","position","width","length","height","inverseMass","inertia","momentum","rotation","angularMomentum","multiplyScalar","setInertia","I_xx","I_yy","I_zz","I_xy","I_yx","I_xz","I_zx","I_yz","I_zy","set","integrate","duration","addScaledVector","I_b_inverse","clone","invert","I_inverse","premultiply","multiply","transpose","angularVelocity","applyMatrix3","dRotation","dRotation_star","z","y","x"],"sources":["/Users/danny/Github/physics_engine_for_the_web/frontend/src/physics_engine/Box.ts"],"sourcesContent":["import * as THREE from \"three\";\nimport { Vector3, Matrix3 } from \"three\";\n\nexport class Box {\n    public inverseMass: number;\n\n    public width: number;\n    public length: number;\n    public height: number;\n\n    public inertia: Matrix3; // inertia tensor in body space\n\n    public position: Vector3;\n    public momentum: Vector3;\n\n    public rotation: Matrix3; // the orientation\n    public angularMomentum: Vector3;\n\n    constructor(position: Vector3, width: number, length: number, height: number) {\n        this.inverseMass = 1 / (width * length * height);\n\n        this.width = width;\n        this.length = length;\n        this.height = height;\n\n        this.inertia = new Matrix3();\n        \n        this.position = position;\n        this.momentum = (new Vector3(1, 0, 0)).multiplyScalar(1/this.inverseMass);\n\n        this.rotation = new Matrix3();\n    }\n\n    private setInertia(): void {\n        const I_xx = (1/12) * (this.length*this.length + this.height*this.height);\n        const I_yy = (1/12) * (this.width*this.width + this.height*this.height);\n        const I_zz = (1/12) * (this.width*this.width + this.length*this.length);\n        const I_xy = (-1/16) * (this.width*this.length);\n        const I_yx = I_xy;\n        const I_xz = (-1/16) * (this.width*this.height);\n        const I_zx = I_xz;\n        const I_yz = (-1/16) * (this.length*this.height);\n        const I_zy = I_yz;\n\n        this.inertia.set(\n            I_xx, I_xy, I_xz,\n            I_yx, I_yy, I_yz,\n            I_zx, I_zy, I_zz\n        );\n    }\n\n    integrate(duration: number): void {\n        // Don't integrate if mass is infinite or duration <= 0.\n        if (this.inverseMass <= 0 || duration <= 0) {\n            return;\n        }\n\n        this.position.addScaledVector(this.momentum, this.inverseMass * duration);\n\n        // update rotation matrix\n        const I_b_inverse = this.inertia.clone().invert();\n        const I_inverse = (I_b_inverse.clone().premultiply(this.rotation)).multiply(this.rotation.clone().transpose());\n        const angularVelocity = this.angularMomentum.clone().applyMatrix3(I_inverse.clone());\n        const dRotation = angularVelocity.multiplyScalar(duration);\n        const dRotation_star = new Matrix3();\n        dRotation_star.set(\n            0, -dRotation.z, dRotation.y,\n            dRotation.z, 0, dRotation.x,\n            -dRotation.y, dRotation.x, 0\n        );\n        this.rotation.premultiply(dRotation_star);\n    }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}